# 浏览器角度的性能优化

## 首屏显示涉及的知识点
- `DNS`解析
- `HTTP`
- `DOM`解析
- `CSS`阻塞
- `JavaScript`阻塞

## 进程与线程
- 进程：一个独立的程序运行环境（占有独立的资源：内存、CPU等资源）
- 线程：单个任务线，依附于进程

### 进程与线程的关系
1. 进程中任意线程出错，都会导致整个进程崩溃;
2. 线程之间，可以共享进程中的数据;
3. 当某个进程关闭后，操作系统将回收进程所占用的资源;
4. 进程之间是相互隔离的

## 浏览器包含的进程
- 浏览器进程：页面显示、用户交互、子进程管理、存储等功能
- 渲染进程：将`HTML`, `CSS`和`JavaScript`转换为用户可与之交互的网页
  - 排版引擎`Blink`
  - `JavaScript`引擎`V8`
- GPU进程
- 绘制`Chrome`的UI界面
- 网络进程：负责网络资源加载
- 插件进程

### 多进程的缺点
- 资源占用高
- 体系架构更加复杂

## 浏览器发送`HTTP`的请求流程
1. 构建请求
构建请求行信息：
`GET /index.html HTTP1.1`
2. 查找缓存
3. 准备`IP`地址和端口
  - `DNS`域名解析
    - `DNS`数据缓存服务 (浏览器缓存)
4. 进入`TCP`队列
  `Chrome`机制决定了，同一域名最多可建立6个`TCP`连接，其余连接将进入`TCP`队列
5. 建立`TCP`连接
6. 发送`HTTP`请求
  - 请求行
    - 请求方法
    - 请求`URI`
    - `HTTP`协议版本
  - 请求头
    - 浏览器所用操作系统
    - 浏览器内核
    - 请求域名信息
    - 浏览器端的`Cookie`信息

## 服务器返回`HTTP`请求流程
1. 返回请求
  - 响应行
    - 状态码
    - 协议版本
  - 响应头
    - 生成数据的时间
    - 返回的数据类型 （JSON, HTML, 流媒体等）
    - `Cookie`等信息
2. 断开连接
  - `TCP`连接发送完毕，即关闭`TCP`连接
  - `Connection: Keep-Alive`，`TCP`连接发送后，仍保持打开状态
3. 重定向
  - 状态码：301 (永久重定向)
  - `Location`: 重定向网址的地址

## 浏览器如何保存登录信息
1. 用户登录后，`POST`提交用户信息至服务器;
2. 服务器验证身份成功后，生成表示用户信息的字符串，并将该字符串写入响应头`Set-Cookie`;
3. 浏览器遇到响应头中含有`Set-Cookie`字段时，将该字段保存至本地;
4. 用户再次请求时，浏览器将发起`HTTP`请求，发起请求前，将`Cookie`信息带在请求头中的`Cookie`字段里;
5. 服务器对`Cookie`字符串的内容进行身份验证，验证登录后，发送数据

## `HTTP`请求发起到结束的八个阶段
1. 构建请求;
2. 查找缓存;
3. 准备`IP`和端口;
4. 等待`TCP`队列;
5. 建立`TCP`连接;
6. 发起`HTTP`请求;
7. 服务器处理请求;
8. 服务器返回请求;
9. 断开连接




























