# V8引擎的垃圾回收
- 栈内存
- 堆内存

## 栈内存回收
通过下移**记录当前执行状态的指针（称为ESP）**

## 堆内存回收
- 代际假说
- 分代收集

### 代际假说特点
- 大部分对象在内存中存在的时间很短
- 不死的对象，活的更久

## V8回收

### 数据存放方式
- 新生代：存放生存时间短的对象
- 老生代：存放生存时间久的对象

### 垃圾回收器
- 副垃圾回收器：负责新生代的垃圾回收
- 主垃圾回收器：负责老生代的垃圾回收

#### 副垃圾回收器
垃圾回收比较频繁

空间划分：新生代中使用`Scavenge算法`，将新生空间划分为两个区域，一半**对象区域**，一半**空闲区域**
清理时机：对象区域快被写满时，需要执行一次垃圾清理
<br />
<br />

垃圾回收步骤：
1. 对对象区域的垃圾做标记;
2. 不进行垃圾清理的对象复制到空闲区域 (这个过程中会进行对象排列);
3. 对象区域与空间区域交换角色。

#### 对象晋升策略
经过两次垃圾回收依然存活的对象，将被移动到老生区中

#### 主垃圾回收器
采用**标记-清除（Mark-Sweep）**算法进行垃圾回收
<br />
<br />

垃圾回收步骤：
1. 从一组根元素开始，遍历这组根元素;
2. 能达到的对象标记为活动对象，不能达到的可判断为垃圾数据。

### 垃圾回收器的工作流程
1. 标记空间中活动对象和非活动对象。（非活动对象可进行垃圾回收）;
2. 回收非活动对象所占据的内存;
3. 内存整理（将内存碎片整理成连续内存）。

## 全停顿
执行垃圾回收算法时，需要将正在执行的`JavaScript`脚本暂停下来，垃圾回收完毕后恢复脚本执行，这种为全停顿


